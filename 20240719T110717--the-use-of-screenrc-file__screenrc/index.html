<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css" />
    <!-- Some html boilerplate omitted -->
    <!-- <link rel="stylesheet" href="/themes/prism-one-light.css" /> -->
    <!-- <link rel="stylesheet" href="/themes/prism-one-dark.css" /> -->
    <!-- <link rel="stylesheet" href="/themes/prism-material-dark.css" /> -->
    <link rel="stylesheet" href="/themes/prism-laserwave.css" />
    <!-- <link rel="stylesheet" href="/themes/new.css" />     -->
    <title>the use of .screenrc file</title>
  </head>
  <body>
    <button onclick="topFunction()" id="topButton" title="Go to top"><b>^</b></button>    
    <header>
      <a href="/">WuZhihao's Blog</a>
      <nav>
        <a href="/about">About</a> 
      </nav>
    </header>
    <main>
      <nav>



<ul class="breadcrumb">
  <li>
    <a href="/">Home</a>
  </li>
  <li class="my-active-class">
    <a href="/20240719T110717--the-use-of-screenrc-file__screenrc/">the-use-of-screenrc-file</a>
  </li>
</ul>
</nav>


      <!--<header><nav>



<ul class="breadcrumb">
  <li>
    <a href="/">Home</a>
  </li>
  <li class="my-active-class">
    <a href="/20240719T110717--the-use-of-screenrc-file__screenrc/">the-use-of-screenrc-file</a>
  </li>
</ul>
</nav>

</header> -->
      
<section>
  <article>
    <h1>the use of .screenrc file</h1>
    <p>
      Published on: 2024-07-19T03:07:17
    </p>
    <h2>Table Of Contents</h2>      
    <nav class="toc" >
        <ul><li><a href="#overview">Overview</a></li><li><a href="#usages">Usages</a><ul><li><a href="#layout-and-groups-management">Layout and Groups Management</a></li><li><a href="#window-management">Window Management</a></li><li><a href="#navigation-bar">Navigation Bar</a></li><li><a href="#system-clipboard">System Clipboard</a></li><li><a href="#miscellaneous">Miscellaneous</a></li></ul></li><li><a href="#other-resources">Other Resources</a></li></ul>
      </nav>
    <h1 id="the-use-of-.screenrc-file" tabindex="-1">The Use of .screenrc File</h1>
<h2 id="overview" tabindex="-1">Overview</h2>
<p>We can use the .screenrc file to configure environmental variables and shortcuts, manage windows, window groups and window layouts.</p>
<h2 id="usages" tabindex="-1">Usages</h2>
<p>My daily conifguration file:</p>
<pre class="language-sh"><code class="language-sh"><span class="token comment">##resize max</span>
defutf8 on
defencoding utf8
encoding UTF-8 UTF-8
setenv <span class="token environment constant">DISPLAY</span> :0
    
nonblock <span class="token number">1</span>
escape ^q^q
shell <span class="token string">"/var/tmp/.scbash"</span>

layout save <span class="token number">0</span>

<span class="token function">screen</span> <span class="token parameter variable">-t</span> <span class="token string">"root"</span> //group
<span class="token function">screen</span> <span class="token parameter variable">-t</span> <span class="token string">"two"</span> //group
<span class="token keyword">select</span> <span class="token number">1</span>
<span class="token function">screen</span> <span class="token parameter variable">-T</span> <span class="token string">"screen-256color"</span>
<span class="token comment"># screen bash --rcfile $HOME/.sptzh/.ssh-bashrc</span>
<span class="token comment"># stuff "^j"</span>

vbell off
<span class="token comment"># layout save def</span>
<span class="token comment"># setenv BASH_ENV /path/to/custom_bashrc</span>
<span class="token comment"># verbose on</span>
attrcolor b <span class="token string">".I"</span> <span class="token comment"># use bright colors for bold</span>
defdynamictitle on
startup_message off
mousetrack off
defmousetrack off
hardstatus on
<span class="token comment"># rendition so =b wk</span>
rendition so <span class="token operator">=</span>b wk
<span class="token comment"># caption always "%?%F%{.B.}%? /%H /%S /%n /%t"</span>
<span class="token comment"># caption always "%?%F%{.B.}%? /%H /%S /%n /%e"</span>
caption always <span class="token string">"%?%F%{kw}%? /%Y%m%d.%c:%s /%H /%S /%n /%e"</span>
<span class="token comment"># caption always "%A||%B||%C||%D||%E||%F||%G||%H||%I||%J||%K||%L||%M||%N||%O||%P||%Q||%R||%S||%T||%U||%V||%W||%X||%Y||%Z||%a||%b||%c||%d||%e||%f||%g||%h||%i||%j||%k||%l||%m||%n||%o||%p||%q||%r||%s||%t||%u||%v||%w||%x||%y||%z"</span>
<span class="token comment">#caption always "%s||%t||%u||%v||%w||%x||%y||%z"</span>

<span class="token comment"># show window list in the buttom</span>
<span class="token comment"># caption always "%{= kw}%-Lw%{= BW}%50>%n%f* %t%{= kw}%+Lw%&lt; %{= kw}[Load:%{= Y}%D%{= kw}]%{= BW}%=%{= kw}%h/%H"</span>
<span class="token comment"># caption always "%{= Wk}%-Lw%50>%{= BW}%n%f* %t%{= Wk}%+Lw%&lt;"    </span>

<span class="token comment">#hardstatus alwayslastline</span>
<span class="token comment">#hardstatus string " %H %S %n %t "</span>
<span class="token comment">#caption always "%{= kw}%-w%{= gW}%n %t%{-}%+w %-= bigdatums.net - %Y-%m-%d %C:%s"</span>
altscreen on <span class="token comment">#fix residual editor text</span>

<span class="token comment"># message display time (seconds)</span>
msgwait <span class="token number">3</span>

deflogin off

<span class="token comment"># enable logging</span>
<span class="token comment"># deflog on</span>
<span class="token comment"># set log location</span>
<span class="token comment"># logfile /root/screen.%n		</span>

<span class="token comment"># nethack off			# nethack like notifications</span>

<span class="token comment"># backtick 0 3600 3600 printf "$USER"</span>
<span class="token comment"># backtick 1 5 5 /bin/bash -c 'cpuLoad=$(cut -s -d\  -f13 &lt;(uptime)); cpuLoad=${cpuLoad:0:-1}; memLoad=...; echo "CPU load ${cpuLoad} Mem Load ${memLoad}" '</span>

multiuser on 
<span class="token comment"># addacl test1,test2</span>

<span class="token comment"># huge scrollback buffer</span>
defscrollback <span class="token number">5000</span>

<span class="token comment"># diable welcome message</span>
startup_message off

<span class="token comment"># scroll with mouse</span>
termcapinfo xterm*<span class="token operator">|</span>rxvt*<span class="token operator">|</span>kterm*<span class="token operator">|</span>Eterm* ti@:te@

<span class="token comment"># Change the xterm initialization string from is2=\E[!p\E[?3;4l\E[4l\E></span>
<span class="token comment"># (This fixes the "Aborted because of window size change" konsole symptoms found</span>
<span class="token comment">#  in bug #134198)</span>
<span class="token comment"># termcapinfo xterm* 'is=\E[r\E[m\E[2J\E[H\E[?7h\E[?1;4;6l'</span>
terminfo rxvt-* <span class="token string">'Co#256:AB=\E[48;5;%dm:AF=\E[38;5;%dm'</span>
<span class="token comment"># term "rxvt-256color"</span>
<span class="token comment"># term "xterm-256color"</span>
term <span class="token string">"screen-256color"</span>

<span class="token comment"># layouts</span>
layout new two
<span class="token keyword">select</span> <span class="token number">2</span>
layout save two

<span class="token builtin class-name">bind</span> <span class="token string">' '</span> layout next <span class="token comment"># &lt;- actually means Ctrl-q + Space</span>
<span class="token comment"># bind ^o focus next</span>
<span class="token builtin class-name">bind</span> ^u focus prev
<span class="token builtin class-name">bind</span> ^g 
<span class="token builtin class-name">bind</span> <span class="token string">"|"</span> <span class="token builtin class-name">eval</span> <span class="token string">"split -v"</span> <span class="token string">"windowlist -b"</span> <span class="token string">"other"</span> <span class="token string">"focus"</span> <span class="token string">"other"</span> <span class="token string">"screen"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"S"</span> <span class="token builtin class-name">eval</span> <span class="token string">"split"</span> <span class="token string">"windowlist -b"</span> <span class="token string">"other"</span> <span class="token string">"focus"</span> <span class="token string">"other"</span> <span class="token string">"screen"</span>
bindkey <span class="token string">"^q^o"</span> <span class="token builtin class-name">eval</span> <span class="token string">"focus next"</span> <span class="token string">"focus next"</span>
bindkey <span class="token string">"^q^y"</span> <span class="token builtin class-name">eval</span> <span class="token string">"focus prev"</span> <span class="token string">"focus prev"</span>
<span class="token comment"># bindkey "^q^r" eval "layout save tmp" "only"</span>
bindkey <span class="token string">"^q^j"</span> other
<span class="token comment"># bind "r" eval "layout save tmp" "only"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"r"</span> <span class="token builtin class-name">eval</span> <span class="token string">"resize _"</span> <span class="token string">"fit"</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'resize -b ='"</span>
<span class="token comment"># bind "3" eval "layout select three"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token keyword">select</span>
<span class="token comment"># bind "u" eval "layout show"</span>
<span class="token builtin class-name">bind</span> s <span class="token builtin class-name">eval</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'layout save '"</span>
bindkey <span class="token string">"^q^m"</span> layout <span class="token keyword">select</span>
<span class="token builtin class-name">bind</span> <span class="token string">"m"</span> layout show
<span class="token comment"># bind \' eval "windowlist -m" "stuff j"</span>
<span class="token builtin class-name">bind</span> <span class="token punctuation">\</span>' <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -m"</span>
<span class="token comment"># bind g eval "screen //group" "title" "screeen"</span>
<span class="token comment"># bind g eval "windowlist -g -m" "stuff ^?" "screen //group" "title" "stuff ^u" </span>
<span class="token builtin class-name">bind</span> g <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff ^?"</span> <span class="token string">"screen //group"</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'eval <span class="token entity" title="\&quot;">\"</span>title <span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>screen<span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>only<span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>layout save '"</span> <span class="token string">"stuff ^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b"</span>
<span class="token comment"># bind C stuff "sudo -E bash --rcfile $(getent passwd $(ls /tmp/.scfile/) | cut -d: -f6)/.sptzh/.ssh-bashrc\n"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"?"</span> <span class="token builtin class-name">eval</span> <span class="token string">"select root"</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff /"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"/"</span> <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff j/"</span>
<span class="token comment"># map to return</span>
<span class="token comment"># bindkey -m "^[l" eval "stuff \015"</span>
bindkey <span class="token parameter variable">-m</span> <span class="token string">"^[j"</span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff jjj"</span>
bindkey <span class="token parameter variable">-m</span> <span class="token string">"^[k"</span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff kkk"</span>

<span class="token comment"># bindkey -m "'" select</span>
<span class="token comment"># bind "h" at \# stuff ". ~/.sptzh/.ssh-bashrc\n" </span>

<span class="token comment"># sync screen buffer to clipboard</span>
<span class="token comment"># bindkey -m > eval "stuff ' '" writebuf "exec sh -c 'xsel -ip &lt; /tmp/screen-exchange'"</span>
<span class="token comment"># bindkey -m > eval "stuff ' '" writebuf "!.. /bin/bash -cx 'printf \"\\033]52;c;\$(printf \"Hello, world\" | base64)\\a\"' | less"</span>
<span class="token comment"># bindkey -m > eval "stuff ' '" writebuf "exec /bin/bash -c 'printf \"\\033P\\033]52;c;\$(cat /tmp/screen-exchange)\\a\\033\\\\\\\\\"'"</span>
bindkey <span class="token parameter variable">-m</span> <span class="token operator">></span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff ' '"</span> writebuf <span class="token string">"exec bash -c '<span class="token variable"><span class="token variable">$(</span>getent <span class="token function">passwd</span> <span class="token punctuation">$(</span>cat /var/tmp/.scuser<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f6</span><span class="token variable">)</span></span>/.sptzh/osc52.sh &lt; /tmp/screen-exchange'"</span>
<span class="token comment"># bindkey -m > eval "stuff ' '" writebuf "exec /bin/bash -cx 'echo xxx$SHELL xx $TERM'"</span>

<span class="token builtin class-name">bind</span> <span class="token string">"j"</span> <span class="token builtin class-name">eval</span> <span class="token string">"copy"</span> <span class="token string">"stuff ' H ' "</span> writebuf <span class="token string">"exec bash -c '<span class="token variable"><span class="token variable">$(</span>getent <span class="token function">passwd</span> <span class="token punctuation">$(</span>cat /var/tmp/.scuser<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f6</span><span class="token variable">)</span></span>/.sptzh/osc52.sh &lt; /tmp/screen-exchange'"</span>

<span class="token comment"># update appearance of horizental or vertical bar</span>
<span class="token comment"># caption string "%{11} "</span>
<span class="token comment"># caption string "%{00}%3n %t"</span>
<span class="token comment"># rendition so =01</span>

<span class="token comment"># make title follow commnad executed</span>
<span class="token comment"># windowlist string "%4n %h%=%f"</span>

<span class="token comment"># shelltitle '$ |something'</span>
maptimeout <span class="token number">100</span>
layout attach :last
layout autosave on
</code></pre>
<h3 id="layout-and-groups-management" tabindex="-1">Layout and Groups Management</h3>
<p>Screen has the ability to create window groups, and nested groups, helping to organise windows efficiently.</p>
<pre class="language-sh"><code class="language-sh"><span class="token function">screen</span> <span class="token parameter variable">-t</span> <span class="token string">"root"</span> //group
<span class="token function">screen</span> <span class="token parameter variable">-t</span> <span class="token string">"two"</span> //group
<span class="token keyword">select</span> <span class="token number">1</span>
<span class="token function">screen</span> <span class="token parameter variable">-T</span> <span class="token string">"screen-256color"</span></code></pre>
<p>Screen doesn't have command to switch window groups directly, but it can be done indirectly using layout. If you create a layout named &quot;two&quot; and configure it with <code>screen -t &quot;two&quot; //group</code>, you can switch to group &quot;two&quot; using the layout command <code>layout select two</code>.</p>
<pre><code>layout new two
select 2
layout save two
</code></pre>
<p>You can create a new layout, select and display layouts.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> s <span class="token builtin class-name">eval</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'layout save '"</span>
bindkey <span class="token string">"^q^m"</span> layout <span class="token keyword">select</span>
<span class="token builtin class-name">bind</span> <span class="token string">"m"</span> layout show</code></pre>
<p>To create a new window group, type the group name in palce of the two &quot;_&quot; cursor positions and add a <code>&quot;</code> in the end of the command: <code>:eval &quot;title _&quot; &quot;screen&quot; &quot;only&quot; &quot;layout save _&quot;</code>.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> g <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff ^?"</span> <span class="token string">"screen //group"</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'eval <span class="token entity" title="\&quot;">\"</span>title <span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>screen<span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>only<span class="token entity" title="\&quot;">\"</span> <span class="token entity" title="\&quot;">\"</span>layout save '"</span> <span class="token string">"stuff ^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b^b"</span></code></pre>
<p>Save the layout when detaching Screen to recover the previous layout when reattaching.</p>
<pre class="language-sh"><code class="language-sh">layout attach :last
layout autosave on</code></pre>
<h3 id="window-management" tabindex="-1">Window Management</h3>
<p>Set the following option to name windows dynamically, making it easier to search for them easily in the window list.</p>
<pre class="language-sh"><code class="language-sh">defdynamictitle on</code></pre>
<p>Using only one region in a Screen window wastes space. Typically I create at least 3 regions, sometimes even 6. To switch between them fluently, I use <code>&lt;C-q&gt;&lt;C-u&gt;</code> and <code>&lt;C-q&gt;&lt;C-i&gt;</code> to select previous and next region. I also create shortcuts to move two region at a time which is efficient when working with 6 regions.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> ^u focus prev
bindkey <span class="token string">"^q^o"</span> <span class="token builtin class-name">eval</span> <span class="token string">"focus next"</span> <span class="token string">"focus next"</span>
bindkey <span class="token string">"^q^y"</span> <span class="token builtin class-name">eval</span> <span class="token string">"focus prev"</span> <span class="token string">"focus prev"</span></code></pre>
<p>Using two different characters to trigger a command is quicker.</p>
<pre class="language-sh"><code class="language-sh">bindkey <span class="token string">"^q^j"</span> other</code></pre>
<p>Regions are initially split with blank content, but we usually create a window in it. Use shortcuts to replace the default ones.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> <span class="token string">"|"</span> <span class="token builtin class-name">eval</span> <span class="token string">"split -v"</span> <span class="token string">"windowlist -b"</span> <span class="token string">"other"</span> <span class="token string">"focus"</span> <span class="token string">"other"</span> <span class="token string">"screen"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"S"</span> <span class="token builtin class-name">eval</span> <span class="token string">"split"</span> <span class="token string">"windowlist -b"</span> <span class="token string">"other"</span> <span class="token string">"focus"</span> <span class="token string">"other"</span> <span class="token string">"screen"</span></code></pre>
<p>Sometimes a region is too small, to temporarily maximise it, use the shortcut below, then <code>&lt;C-M&gt;</code> to restore.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> <span class="token string">"r"</span> <span class="token builtin class-name">eval</span> <span class="token string">"resize _"</span> <span class="token string">"fit"</span> <span class="token string">"colon"</span> <span class="token string">"stuff 'resize -b ='"</span></code></pre>
<p>You can display window list of current window group in the order of most recently used.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> <span class="token string">"<span class="token entity" title="\&quot;">\"</span>"</span> <span class="token keyword">select</span>
<span class="token builtin class-name">bind</span> <span class="token punctuation">\</span>' <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -m"</span></code></pre>
<p>You can search windows by name. The first line searches within the current group, while the second searches across all groups.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> <span class="token string">"/"</span> <span class="token builtin class-name">eval</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff j/"</span>
<span class="token builtin class-name">bind</span> <span class="token string">"?"</span> <span class="token builtin class-name">eval</span> <span class="token string">"select root"</span> <span class="token string">"windowlist -g -m"</span> <span class="token string">"stuff /"</span></code></pre>
<p>You can use <code>&lt;M-j&gt;</code> and <code>&lt;M-k&gt;</code> to move quickly through the window group list.</p>
<pre class="language-sh"><code class="language-sh">bindkey <span class="token parameter variable">-m</span> <span class="token string">"^[j"</span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff jjj"</span>
bindkey <span class="token parameter variable">-m</span> <span class="token string">"^[k"</span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff kkk"</span></code></pre>
<h3 id="navigation-bar" tabindex="-1">Navigation Bar</h3>
<p>Hardstatus is useful for displaying the window infomation or indicating the currently active window.</p>
<pre class="language-sh"><code class="language-sh">hardstatus on
<span class="token comment"># rendition so =b wk</span>
rendition so <span class="token operator">=</span>b wk
<span class="token comment"># caption always "%?%F%{.B.}%? /%H /%S /%n /%t"</span>
<span class="token comment"># caption always "%?%F%{.B.}%? /%H /%S /%n /%e"</span>
caption always <span class="token string">"%?%F%{kw}%? /%Y%m%d.%c:%s /%H /%S /%n /%e"</span></code></pre>
<p>After exiting Emacs or Vim, Residual content may remain on the screen, enable the option to clear them.</p>
<pre class="language-sh"><code class="language-sh">altscreen on <span class="token comment">#fix residual editor text</span></code></pre>
<h3 id="system-clipboard" tabindex="-1">System Clipboard</h3>
<p>You can copy highlighted content to clipboard, even it's in a remote SSH connection.</p>
<pre class="language-sh"><code class="language-sh">bindkey <span class="token parameter variable">-m</span> <span class="token operator">></span> <span class="token builtin class-name">eval</span> <span class="token string">"stuff ' '"</span> writebuf <span class="token string">"exec bash -c '<span class="token variable"><span class="token variable">$(</span>getent <span class="token function">passwd</span> <span class="token punctuation">$(</span>cat /var/tmp/.scuser<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f6</span><span class="token variable">)</span></span>/.sptzh/osc52.sh &lt; /tmp/screen-exchange'"</span></code></pre>
<p>osc52.sh:</p>
<pre class="language-sh"><code class="language-sh"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment"># Copyright (c) 2012 The Chromium OS Authors. All rights reserved.</span>
<span class="token comment"># Use of this source code is governed by a BSD-style license that can be</span>
<span class="token comment"># found in the LICENSE file.</span>

<span class="token comment"># Max length of the OSC 52 sequence.  Sequences longer than this will not be</span>
<span class="token comment"># sent to the terminal.</span>
<span class="token assign-left variable">OSC_52_MAX_SEQUENCE</span><span class="token operator">=</span><span class="token string">"100000"</span>

<span class="token comment"># Write an error message and exit.</span>
<span class="token comment"># Usage: &lt;message></span>
<span class="token function-name function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">echo</span> <span class="token string">"ERROR: <span class="token variable">$*</span>"</span>
  <span class="token builtin class-name">exit</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment"># Send a DCS sequence through tmux.</span>
<span class="token comment"># Usage: &lt;sequence></span>
<span class="token function-name function">tmux_dcs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">printf</span> <span class="token string">'\033Ptmux;\033%s\033\\'</span> <span class="token string">"<span class="token variable">$1</span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Send a DCS sequence through screen.</span>
<span class="token comment"># Usage: &lt;sequence></span>
<span class="token function-name function">screen_dcs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment"># Screen limits the length of string sequences, so we have to break it up.</span>
  <span class="token comment"># Going by the screen history:</span>
  <span class="token comment">#   (v4.2.1) Apr 2014 - today: 768 bytes</span>
  <span class="token comment">#   Aug 2008 - Apr 2014 (v4.2.0): 512 bytes</span>
  <span class="token comment">#   ??? - Aug 2008 (v4.0.3): 256 bytes</span>
  <span class="token comment"># Since v4.2.0 is only ~4 years old, we'll use the 256 limit.</span>
  <span class="token comment"># We can probably switch to the 768 limit in 2022.</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">limit</span><span class="token operator">=</span><span class="token number">256</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token parameter variable">-eq</span> <span class="token string">"1"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># We go 4 bytes under the limit because we're going to insert 2 bytes</span>
    <span class="token comment"># before (\eP) and 2 bytes after (\e\) each string.</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">sed</span> <span class="token parameter variable">-E</span> <span class="token string">"s:.{<span class="token variable"><span class="token variable">$((</span> limit <span class="token operator">-</span> <span class="token number">4</span> <span class="token variable">))</span></span>}:&amp;<span class="token entity" title="\n">\n</span>:g"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">sed</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-e</span> <span class="token string">'s:^:\x1bP:'</span> <span class="token parameter variable">-e</span> <span class="token string">'s:$:\x1b\\:'</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'\n'</span>
  <span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token parameter variable">-eq</span> <span class="token string">"2"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token comment"># We go 10 bytes under the limit because we're going to insert 4 bytes</span>
    <span class="token comment"># before (\eP\eP) and 6 bytes after (\e\) each string.</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">$1</span>"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">sed</span> <span class="token parameter variable">-E</span> <span class="token string">"s:.{<span class="token variable"><span class="token variable">$((</span> limit <span class="token operator">-</span> <span class="token number">10</span> <span class="token variable">))</span></span>}:&amp;<span class="token entity" title="\n">\n</span>:g"</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">sed</span> <span class="token parameter variable">-E</span> <span class="token parameter variable">-e</span> <span class="token string">'s:^:\x1bP\x1bP:'</span> <span class="token parameter variable">-e</span> <span class="token string">'s:$:\x1b\x1b\\\x1b\\\\:'</span> <span class="token operator">|</span> <span class="token punctuation">\</span>
      <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'\n'</span>
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># Send an escape sequence to hterm.</span>
<span class="token comment"># Usage: &lt;sequence></span>
<span class="token function-name function">print_seq</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> <span class="token assign-left variable">seq</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span>

  <span class="token keyword">case</span> <span class="token variable">${<span class="token environment constant">TERM</span>-}</span> <span class="token keyword">in</span>
  screen*<span class="token punctuation">)</span>
    <span class="token comment"># Since tmux defaults to setting TERM=screen (ugh), we need to detect</span>
    <span class="token comment"># it here specially.</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${TMUX-}</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      tmux_dcs <span class="token string">"<span class="token variable">${seq}</span>"</span>
    <span class="token keyword">else</span>
      screen_dcs <span class="token string">"<span class="token variable">${seq}</span>"</span> <span class="token string">"<span class="token variable">${SCREEN_LEVEL<span class="token operator">:-</span>1}</span>"</span>
    <span class="token keyword">fi</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  tmux*<span class="token punctuation">)</span>
    tmux_dcs <span class="token string">"<span class="token variable">${seq}</span>"</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  *<span class="token punctuation">)</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">"<span class="token variable">${seq}</span>"</span>
    <span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token keyword">esac</span>
<span class="token punctuation">}</span>

<span class="token comment"># Base64 encode stdin.</span>
<span class="token function-name function">b64enc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  base64 <span class="token operator">|</span> <span class="token function">tr</span> <span class="token parameter variable">-d</span> <span class="token string">'\n'</span>
<span class="token punctuation">}</span>

<span class="token comment"># Send the OSC 52 sequence to copy the content.</span>
<span class="token comment"># Usage: [string]</span>
<span class="token function-name function">copy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">local</span> str

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span>b64enc<span class="token variable">)</span></span>"</span>
  <span class="token keyword">else</span>
    <span class="token assign-left variable">str</span><span class="token operator">=</span><span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$@</span>"</span> <span class="token operator">|</span> b64enc<span class="token variable">)</span></span>"</span>
  <span class="token keyword">fi</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${OSC_52_MAX_SEQUENCE}</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">local</span> <span class="token assign-left variable">len</span><span class="token operator">=</span><span class="token variable">${<span class="token operator">#</span>str}</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">${len}</span> <span class="token parameter variable">-gt</span> <span class="token variable">${OSC_52_MAX_SEQUENCE}</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
      die <span class="token string">"selection too long to send to terminal:"</span> <span class="token punctuation">\</span>
        <span class="token string">"<span class="token variable">${OSC_52_MAX_SEQUENCE}</span> limit, <span class="token variable">${len}</span> attempted"</span>
    <span class="token keyword">fi</span>
  <span class="token keyword">fi</span>

  print_seq <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">printf</span> <span class="token string">'\033]52;c;%s\a'</span> <span class="token string">"<span class="token variable">${str}</span>"</span><span class="token variable">)</span></span>"</span>
<span class="token punctuation">}</span>

<span class="token comment"># Write tool usage and exit.</span>
<span class="token comment"># Usage: [error message]</span>
<span class="token function-name function">usage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">exec</span> <span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token file-descriptor important">&amp;2</span>
  <span class="token keyword">fi</span>
  <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF
Usage: osc52 [options] [string]

Send an arbitrary string to the terminal clipboard using the OSC 52 escape
sequence as specified in xterm:
  https://invisible-island.net/xterm/ctlseqs/ctlseqs.html
  Section "Operating System Controls", Ps => 52.

The data can either be read from stdin:
  $ echo "hello world" | osc52.sh

Or specified on the command line:
  $ osc52.sh "hello world"

Options:
  -h, --help    This screen.
  -f, --force   Ignore max byte limit (<span class="token variable">${OSC_52_MAX_SEQUENCE}</span>)
EOF</span>

  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">echo</span>
    die <span class="token string">"<span class="token variable">$@</span>"</span>
  <span class="token keyword">else</span>
    <span class="token builtin class-name">exit</span> <span class="token number">0</span>
  <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

  <span class="token keyword">while</span> <span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-gt</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">do</span>
    <span class="token keyword">case</span> <span class="token variable">$1</span> <span class="token keyword">in</span>
    -h<span class="token operator">|</span>--help<span class="token punctuation">)</span>
      usage
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -f<span class="token operator">|</span>--force<span class="token punctuation">)</span>
      <span class="token assign-left variable">OSC_52_MAX_SEQUENCE</span><span class="token operator">=</span><span class="token number">0</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    -*<span class="token punctuation">)</span>
      usage <span class="token string">"Unknown option: <span class="token variable">$1</span>"</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    *<span class="token punctuation">)</span>
      <span class="token builtin class-name">break</span>
      <span class="token punctuation">;</span><span class="token punctuation">;</span>
    <span class="token keyword">esac</span>
    <span class="token builtin class-name">shift</span>
  <span class="token keyword">done</span>

  copy <span class="token string">"<span class="token variable">$@</span>"</span>
<span class="token punctuation">}</span>
main <span class="token string">"<span class="token variable">$@</span>"</span></code></pre>
<p>You can copy content from cursor position to the top of a terminal quickly to clipboard using the following shortcuts.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> <span class="token string">"j"</span> <span class="token builtin class-name">eval</span> <span class="token string">"copy"</span> <span class="token string">"stuff ' H ' "</span> writebuf <span class="token string">"exec bash -c '<span class="token variable"><span class="token variable">$(</span>getent <span class="token function">passwd</span> <span class="token punctuation">$(</span>cat /var/tmp/.scuser<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">cut</span> -d: <span class="token parameter variable">-f6</span><span class="token variable">)</span></span>/.sptzh/osc52.sh &lt; /tmp/screen-exchange'"</span></code></pre>
<h3 id="miscellaneous" tabindex="-1">Miscellaneous</h3>
<p>Change the escape key because the default <code>^a</code> is often used in Bash, while <code>^q</code> is used for quote insertion in Bash and Emacs and is rarely needed, so it's a good choice to use <code>^q</code>.</p>
<pre class="language-sh"><code class="language-sh">escape ^q^q</code></pre>
<p>If you run Screen on a remote server and the TCP connection becomes unstable, Screen may get blocked. To recover from a blocked state after 1 second, set the following option:</p>
<pre class="language-sh"><code class="language-sh">nonblock <span class="token number">1</span></code></pre>
<p>Set long scrollback buffer to retain more history information.</p>
<pre class="language-sh"><code class="language-sh">defscrollback <span class="token number">5000</span></code></pre>
<p>Enable mouse support in GNU Screen.</p>
<pre class="language-sh"><code class="language-sh">termcapinfo xterm*<span class="token operator">|</span>rxvt*<span class="token operator">|</span>kterm*<span class="token operator">|</span>Eterm* ti@:te@</code></pre>
<p>Specify the terminal type to enbale the 256-color support.</p>
<pre class="language-sh"><code class="language-sh">terminfo rxvt-* <span class="token string">'Co#256:AB=\E[48;5;%dm:AF=\E[38;5;%dm'</span>
term <span class="token string">"screen-256color"</span></code></pre>
<p>Turn off the welcome page.</p>
<pre class="language-sh"><code class="language-sh">startup_message off</code></pre>
<p>Mouse track is useful when switching between many regions, but it doesn't work well on 2K monitors, so I disable it. I found that clicking the right-most window activates the left most one, which is incorrect.</p>
<pre class="language-sh"><code class="language-sh">mousetrack off
defmousetrack off</code></pre>
<p>Showing message for long time is annoying, so I reduce it to 3 seconds.</p>
<pre class="language-sh"><code class="language-sh"><span class="token comment"># message display time (seconds)</span>
msgwait <span class="token number">3</span></code></pre>
<p>Diable login to prevent entries from appearing in the <code>w</code> command output. This can avoid causing concern for customers if there are many login terminals.</p>
<pre class="language-sh"><code class="language-sh">deflogin off</code></pre>
<p>I unbind ^g to avoid accidentally switching to vbell mode when using Emacs.</p>
<pre class="language-sh"><code class="language-sh"><span class="token builtin class-name">bind</span> ^g </code></pre>
<p>Shorten the delay between inputs when using escape sequence.</p>
<pre class="language-sh"><code class="language-sh">maptimeout <span class="token number">100</span></code></pre>
<h2 id="other-resources" tabindex="-1">Other Resources</h2>
<p>I get osc52.sh from <a href="https://chromium.googlesource.com/apps/libapps/+/master/nassh/doc/FAQ.md#Is-OSC-52-aka-clipboard-operations_supported">https://chromium.googlesource.com/apps/libapps/+/master/nassh/doc/FAQ.md#Is-OSC-52-aka-clipboard-operations_supported</a>.</p>

  </article>
</section>
    </main>
    <script src="/javascript/bundle.js"></script>
    </script>
  </body>
</html>
